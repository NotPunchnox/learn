#Requires -Version 5.1
#Requires -RunAsAdministrator

<#
.SYNOPSIS
    Script de configuration automatisÃ©e et sÃ©curisÃ©e du serveur Windows pour GSB
.DESCRIPTION
    Configure automatiquement AD DS, DNS, DHCP, structure OU, utilisateurs, groupes, partages et GPO
    - Installation automatique des services manquants
    - Promotion en contrÃ´leur de domaine si nÃ©cessaire
    - Mot de passe unifiÃ© pour tous les comptes
.NOTES
    Version: 3.5 Final
    Auteur: Expert PowerShell
    Date: 2025-11-12
    PrÃ©requis: Windows Server 2019/2022, Disque D: disponible, droits administrateur
#>

[CmdletBinding()]
param()

#REGION: VÃ©rification des prÃ©requis
if ($PSVersionTable.PSVersion.Major -lt 5) {
    Write-Error "âŒ PowerShell 5.1 ou supÃ©rieur est requis."
    exit 1
}

$currentUser = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())
if (-not $currentUser.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Error "âŒ Ce script doit Ãªtre exÃ©cutÃ© avec des privilÃ¨ges d'administrateur."
    exit 1
}
#ENDREGION

#REGION: Configuration Globale
$ErrorActionPreference = "Stop"
$ProgressPreference = "SilentlyContinue"

# Mot de passe unifiÃ© pour tous les comptes
$GLOBAL_PASSWORD = "Ndlp#2022"

$Config = @{
    Domain = @{
        Name = "gsb.local"
        NetBIOS = "GSB"
        SafeModePassword = $GLOBAL_PASSWORD
    }
    Server = @{
        Name = "ADLAB"
        IP = "192.168.1.10"
        PrefixLength = 24
        Gateway = "192.168.1.1"
        DNS = "127.0.0.1"  # Pointe vers lui-mÃªme aprÃ¨s installation DNS
    }
    DHCP = @{
        ScopeName = "GSBScope"
        ScopeStart = "192.168.1.100"
        ScopeEnd = "192.168.1.200"
        SubnetMask = "255.255.255.0"
        ScopeID = "192.168.1.0"
        ExclusionStart = "192.168.1.150"
        ExclusionEnd = "192.168.1.160"
    }
    Password = $GLOBAL_PASSWORD
    Services = @(
        "ReseauSysteme",
        "DirectionDSI",
        "Administratif",
        "Developpement",
        "Commercial",
        "LaboRecherche",
        "Accueil",
        "DemonstrationVisiteursSortieVersInternet"
    )
    Paths = @{
        Profils = "D:\Profils"
        Documents = "D:\Documents"
        Reports = "$env:USERPROFILE\Desktop\Rapports_GSB"
    }
}

# Variable de suivi de l'Ã©tat du script
$ScriptState = @{
    ServerRenamed = $false
    RolesInstalled = $false
    ADInstalled = $false
    DHCPConfigured = $false
}
#ENDREGION

#REGION: Fonctions Utilitaires
function Write-Log {
    param(
        [Parameter(Mandatory)]
        [string]$Message,
        [ValidateSet('Info', 'Warning', 'Error', 'Success')]
        [string]$Level = 'Info'
    )
    
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $colors = @{
        'Info' = 'Cyan'
        'Warning' = 'Yellow'
        'Error' = 'Red'
        'Success' = 'Green'
    }
    
    $icons = @{
        'Info' = 'â„¹ï¸'
        'Warning' = 'âš ï¸'
        'Error' = 'âŒ'
        'Success' = 'âœ…'
    }
    
    Write-Host "[$timestamp] $($icons[$Level]) $Message" -ForegroundColor $colors[$Level]
    
    $logFile = Join-Path $Config.Paths.Reports "Installation.log"
    if (Test-Path $Config.Paths.Reports) {
        "[$timestamp] [$Level] $Message" | Out-File -FilePath $logFile -Append -Encoding UTF8
    }
}

function Test-PendingReboot {
    $paths = @(
        "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\RebootPending",
        "HKLM:\Software\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update\RebootRequired"
    )
    
    foreach ($path in $paths) {
        if (Test-Path $path) { return $true }
    }
    
    $prop = Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager" -Name "PendingFileRenameOperations" -ErrorAction SilentlyContinue
    if ($prop) { return $true }
    
    return $false
}

function Initialize-Environment {
    Write-Log "ğŸ”§ Initialisation de l'environnement..." -Level Info
    
    # CrÃ©ation du dossier de rapports
    if (-not (Test-Path $Config.Paths.Reports)) {
        New-Item -Path $Config.Paths.Reports -ItemType Directory -Force | Out-Null
        Write-Log "Dossier de rapports crÃ©Ã©: $($Config.Paths.Reports)" -Level Success
    }
    
    # VÃ©rification du disque D:
    if (-not (Get-PSDrive -Name "D" -ErrorAction SilentlyContinue)) {
        Write-Log "Le disque D: n'existe pas. CrÃ©ation/VÃ©rification en cours..." -Level Warning
        
        # Tentative de crÃ©ation si possible (partition non allouÃ©e)
        $disk = Get-Disk | Where-Object { $_.PartitionStyle -eq 'RAW' -or ($_.AllocatedSize -lt $_.Size) } | Select-Object -First 1
        
        if ($disk) {
            Write-Log "Disque non partitionnÃ© dÃ©tectÃ©. Tentative de crÃ©ation de la partition D:..." -Level Info
            try {
                Initialize-Disk -Number $disk.Number -PartitionStyle GPT -ErrorAction Stop
                New-Partition -DiskNumber $disk.Number -UseMaximumSize -DriveLetter D | Format-Volume -FileSystem NTFS -NewFileSystemLabel "Data" -Confirm:$false
                Write-Log "Partition D: crÃ©Ã©e avec succÃ¨s." -Level Success
            }
            catch {
                Write-Log "Impossible de crÃ©er automatiquement le disque D:. Veuillez le crÃ©er manuellement." -Level Error
                throw "Disque D: requis mais non disponible"
            }
        }
        else {
            Write-Log "Aucun disque disponible pour crÃ©er D:. Veuillez configurer le disque D: manuellement." -Level Error
            throw "Disque D: non disponible"
        }
    }
    else {
        Write-Log "Disque D: dÃ©tectÃ© et disponible." -Level Success
    }
    
    Write-Log "Environnement initialisÃ© avec succÃ¨s." -Level Success
}

function Test-ADDomainController {
    try {
        $domain = Get-ADDomain -ErrorAction Stop
        $dc = Get-ADDomainController -ErrorAction Stop
        return @{
            IsDomainController = $true
            DomainName = $domain.DNSRoot
            DCName = $dc.Name
        }
    }
    catch {
        return @{
            IsDomainController = $false
            DomainName = $null
            DCName = $null
        }
    }
}

function Install-RequiredModules {
    Write-Log "ğŸ“¦ VÃ©rification et installation des modules PowerShell requis..." -Level Info
    
    $modules = @('ServerManager', 'ActiveDirectory', 'DhcpServer', 'GroupPolicy')
    
    foreach ($module in $modules) {
        if (-not (Get-Module -ListAvailable -Name $module)) {
            Write-Log "Module $module non trouvÃ©. Installation via les fonctionnalitÃ©s Windows..." -Level Warning
            
            # Correspondance module -> fonctionnalitÃ©
            $featureMap = @{
                'ServerManager' = 'RSAT-AD-PowerShell'
                'ActiveDirectory' = 'RSAT-AD-PowerShell'
                'DhcpServer' = 'RSAT-DHCP'
                'GroupPolicy' = 'GPMC'
            }
            
            if ($featureMap.ContainsKey($module)) {
                try {
                    Install-WindowsFeature -Name $featureMap[$module] -IncludeManagementTools -ErrorAction Stop | Out-Null
                    Write-Log "Module $module installÃ© via $($featureMap[$module])." -Level Success
                }
                catch {
                    Write-Log "Avertissement: Impossible d'installer $module automatiquement." -Level Warning
                }
            }
        }
        else {
            Write-Log "Module $module dÃ©jÃ  disponible." -Level Success
        }
    }
}
#ENDREGION

#REGION: Phase 1 - Configuration de Base
function Set-ServerName {
    $currentName = $env:COMPUTERNAME
    
    if ($currentName -ne $Config.Server.Name) {
        Write-Log "ğŸ”„ Renommage du serveur: $currentName â†’ $($Config.Server.Name)" -Level Info
        
        try {
            Rename-Computer -NewName $Config.Server.Name -Force -ErrorAction Stop
            Write-Log "Serveur renommÃ© avec succÃ¨s. RedÃ©marrage requis." -Level Warning
            return $true
        }
        catch {
            Write-Log "Erreur lors du renommage: $_" -Level Error
            throw
        }
    }
    else {
        Write-Log "Le nom du serveur est dÃ©jÃ  correct: $currentName" -Level Success
        return $false
    }
}

function Set-StaticIP {
    Write-Log "ğŸŒ Configuration de l'adresse IP statique..." -Level Info
    
    try {
        # DÃ©tection de l'interface principale
        $adapter = Get-NetAdapter | Where-Object { 
            $_.Status -eq "Up" -and 
            $_.InterfaceDescription -notmatch "Loopback|Virtual|Hyper-V"
        } | Select-Object -First 1
        
        if (-not $adapter) {
            throw "Aucune interface rÃ©seau active dÃ©tectÃ©e"
        }
        
        Write-Log "Interface rÃ©seau dÃ©tectÃ©e: $($adapter.Name) - $($adapter.InterfaceDescription)" -Level Info
        
        # Suppression des configurations IP existantes
        Get-NetIPAddress -InterfaceAlias $adapter.Name -AddressFamily IPv4 -ErrorAction SilentlyContinue | 
            Remove-NetIPAddress -Confirm:$false -ErrorAction SilentlyContinue
        
        Get-NetRoute -InterfaceAlias $adapter.Name -DestinationPrefix "0.0.0.0/0" -ErrorAction SilentlyContinue | 
            Remove-NetRoute -Confirm:$false -ErrorAction SilentlyContinue
        
        # Configuration de la nouvelle IP
        New-NetIPAddress -InterfaceAlias $adapter.Name `
                         -IPAddress $Config.Server.IP `
                         -PrefixLength $Config.Server.PrefixLength `
                         -DefaultGateway $Config.Server.Gateway `
                         -ErrorAction Stop | Out-Null
        
        # Configuration DNS (loopback pour le futur serveur DNS)
        Set-DnsClientServerAddress -InterfaceAlias $adapter.Name `
                                    -ServerAddresses $Config.Server.DNS `
                                    -ErrorAction Stop
        
        # DÃ©finir le profil rÃ©seau comme "PrivÃ©"
        Get-NetConnectionProfile -InterfaceAlias $adapter.Name | 
            Set-NetConnectionProfile -NetworkCategory Private -ErrorAction SilentlyContinue
        
        Write-Log "IP configurÃ©e: $($Config.Server.IP)/$($Config.Server.PrefixLength)" -Level Success
        Write-Log "Passerelle: $($Config.Server.Gateway)" -Level Success
        Write-Log "DNS: $($Config.Server.DNS)" -Level Success
        
        return $adapter.Name
    }
    catch {
        Write-Log "Erreur configuration IP: $_" -Level Error
        throw
    }
}

function Install-ServerRoles {
    Write-Log "ğŸ“¥ Installation des rÃ´les serveur (AD DS, DNS, DHCP)..." -Level Info
    
    try {
        $requiredFeatures = @('AD-Domain-Services', 'DNS', 'DHCP')
        $managementTools = @('RSAT-AD-Tools', 'RSAT-DHCP', 'RSAT-DNS-Server', 'GPMC')
        
        $allFeatures = $requiredFeatures + $managementTools
        
        # VÃ©rification des fonctionnalitÃ©s dÃ©jÃ  installÃ©es
        $installedFeatures = Get-WindowsFeature | Where-Object { $_.Installed -eq $true }
        $missingFeatures = $allFeatures | Where-Object { 
            $_ -notin $installedFeatures.Name 
        }
        
        if ($missingFeatures.Count -eq 0) {
            Write-Log "Tous les rÃ´les sont dÃ©jÃ  installÃ©s." -Level Success
            return $false
        }
        
        Write-Log "Installation de $($missingFeatures.Count) fonctionnalitÃ©(s) manquante(s)..." -Level Info
        
        $result = Install-WindowsFeature -Name $missingFeatures -IncludeManagementTools -ErrorAction Stop
        
        if ($result.Success) {
            Write-Log "RÃ´les installÃ©s avec succÃ¨s." -Level Success
            
            if ($result.RestartNeeded -eq 'Yes') {
                Write-Log "RedÃ©marrage nÃ©cessaire aprÃ¨s installation des rÃ´les." -Level Warning
                return $true
            }
        }
        else {
            throw "Ã‰chec de l'installation des rÃ´les"
        }
        
        return $false
    }
    catch {
        Write-Log "Erreur lors de l'installation des rÃ´les: $_" -Level Error
        throw
    }
}
#ENDREGION

#REGION: Phase 2 - Active Directory
function Install-ADDSForest {
    Write-Log "ğŸŒ³ Installation de la forÃªt Active Directory..." -Level Info
    
    try {
        # VÃ©rification si AD DS est dÃ©jÃ  installÃ©
        $adFeature = Get-WindowsFeature -Name "AD-Domain-Services"
        
        if (-not $adFeature.Installed) {
            Write-Log "AD DS n'est pas installÃ©. Installation en cours..." -Level Warning
            Install-WindowsFeature -Name "AD-Domain-Services" -IncludeManagementTools
        }
        
        $securePassword = ConvertTo-SecureString $Config.Domain.SafeModePassword -AsPlainText -Force
        
        $params = @{
            DomainName = $Config.Domain.Name
            DomainNetbiosName = $Config.Domain.NetBIOS
            SafeModeAdministratorPassword = $securePassword
            InstallDns = $true
            CreateDnsDelegation = $false
            DatabasePath = "C:\Windows\NTDS"
            LogPath = "C:\Windows\NTDS"
            SysvolPath = "C:\Windows\SYSVOL"
            NoRebootOnCompletion = $false
            Force = $true
        }
        
        Write-Log "Lancement de la promotion en contrÃ´leur de domaine..." -Level Info
        Write-Log "Domaine: $($Config.Domain.Name) | NetBIOS: $($Config.Domain.NetBIOS)" -Level Info
        
        Install-ADDSForest @params
        
        Write-Log "ForÃªt AD installÃ©e. Le serveur va redÃ©marrer automatiquement." -Level Success
    }
    catch {
        Write-Log "Erreur lors de l'installation d'Active Directory: $_" -Level Error
        throw
    }
}

function Test-AndPromoteDomainController {
    Write-Log "ğŸ” VÃ©rification du statut de contrÃ´leur de domaine..." -Level Info
    
    $dcStatus = Test-ADDomainController
    
    if ($dcStatus.IsDomainController) {
        Write-Log "Le serveur est dÃ©jÃ  un contrÃ´leur de domaine pour: $($dcStatus.DomainName)" -Level Success
        return $false
    }
    
    # VÃ©rifier si AD DS est installÃ© mais pas promu
    $adFeature = Get-WindowsFeature -Name "AD-Domain-Services" -ErrorAction SilentlyContinue
    
    if ($adFeature -and $adFeature.Installed) {
        Write-Log "AD DS est installÃ© mais le serveur n'est pas un contrÃ´leur de domaine." -Level Warning
        Write-Log "Promotion en contrÃ´leur de domaine nÃ©cessaire." -Level Warning
        return $true
    }
    
    Write-Log "AD DS n'est pas encore installÃ©." -Level Info
    return $true
}
#ENDREGION

#REGION: Phase 3 - Configuration Post-AD
function Configure-DHCP {
    Write-Log "ğŸ–¥ï¸ Configuration du serveur DHCP..." -Level Info
    
    try {
        # Import du module DHCP
        Import-Module DhcpServer -ErrorAction Stop
        
        $fqdn = "$($Config.Server.Name).$($Config.Domain.Name)"
        
        # Autorisation du serveur DHCP dans AD
        try {
            Add-DhcpServerInDC -DnsName $fqdn -IPAddress $Config.Server.IP -ErrorAction Stop
            Write-Log "Serveur DHCP autorisÃ© dans Active Directory." -Level Success
        }
        catch {
            if ($_.Exception.Message -match "already authorized") {
                Write-Log "Serveur DHCP dÃ©jÃ  autorisÃ© dans AD." -Level Info
            }
            else {
                throw $_
            }
        }
        
        # VÃ©rification de l'existence de l'Ã©tendue
        $existingScope = Get-DhcpServerv4Scope -ErrorAction SilentlyContinue | 
                         Where-Object { $_.ScopeId -eq $Config.DHCP.ScopeID }
        
        if (-not $existingScope) {
            Add-DhcpServerv4Scope -Name $Config.DHCP.ScopeName `
                                  -StartRange $Config.DHCP.ScopeStart `
                                  -EndRange $Config.DHCP.ScopeEnd `
                                  -SubnetMask $Config.DHCP.SubnetMask `
                                  -State Active `
                                  -ErrorAction Stop
            
            Write-Log "Ã‰tendue DHCP crÃ©Ã©e: $($Config.DHCP.ScopeStart) - $($Config.DHCP.ScopeEnd)" -Level Success
        }
        else {
            Write-Log "Ã‰tendue DHCP dÃ©jÃ  existante." -Level Info
        }
        
        # Configuration de la plage d'exclusion
        $existingExclusion = Get-DhcpServerv4ExclusionRange -ScopeId $Config.DHCP.ScopeID -ErrorAction SilentlyContinue
        
        if (-not $existingExclusion) {
            Add-DhcpServerv4ExclusionRange -ScopeId $Config.DHCP.ScopeID `
                                            -StartRange $Config.DHCP.ExclusionStart `
                                            -EndRange $Config.DHCP.ExclusionEnd `
                                            -ErrorAction Stop
            
            Write-Log "Plage d'exclusion configurÃ©e: $($Config.DHCP.ExclusionStart) - $($Config.DHCP.ExclusionEnd)" -Level Success
        }
        else {
            Write-Log "Plage d'exclusion dÃ©jÃ  configurÃ©e." -Level Info
        }
        
        # Configuration des options DHCP
        Set-DhcpServerv4OptionValue -ScopeId $Config.DHCP.ScopeID `
                                     -DnsServer $Config.Server.IP `
                                     -DnsDomain $Config.Domain.Name `
                                     -Router $Config.Server.Gateway `
                                     -ErrorAction Stop
        
        Write-Log "Options DHCP configurÃ©es (DNS, Domaine, Passerelle)." -Level Success
        
        # Finalisation de la configuration DHCP
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\ServerManager\Roles\12" `
                         -Name "ConfigurationState" -Value 2 -ErrorAction SilentlyContinue
        
        Write-Log "Configuration DHCP terminÃ©e avec succÃ¨s." -Level Success
    }
    catch {
        Write-Log "Erreur lors de la configuration DHCP: $_" -Level Error
        throw
    }
}

function New-OUStructure {
    Write-Log "ğŸ“ CrÃ©ation de la structure des unitÃ©s d'organisation..." -Level Info
    
    try {
        Import-Module ActiveDirectory -ErrorAction Stop
        
        $domainDN = (Get-ADDomain).DistinguishedName
        
        foreach ($service in $Config.Services) {
            $ouPath = "OU=$service,$domainDN"
            
            $existingOU = Get-ADOrganizationalUnit -Filter "DistinguishedName -eq '$ouPath'" -ErrorAction SilentlyContinue
            
            if (-not $existingOU) {
                New-ADOrganizationalUnit -Name $service `
                                          -Path $domainDN `
                                          -ProtectedFromAccidentalDeletion $true `
                                          -ErrorAction Stop
                
                Write-Log "OU crÃ©Ã©e: $service" -Level Success
            }
            else {
                Write-Log "OU existe dÃ©jÃ : $service" -Level Info
            }
        }
        
        Write-Log "Structure OU crÃ©Ã©e avec succÃ¨s." -Level Success
    }
    catch {
        Write-Log "Erreur lors de la crÃ©ation des OU: $_" -Level Error
        throw
    }
}

function New-ADGroupStructure {
    Write-Log "ğŸ‘¥ CrÃ©ation de la structure des groupes (AGDLP)..." -Level Info
    
    try {
        $domainDN = (Get-ADDomain).DistinguishedName
        
        foreach ($service in $Config.Services) {
            $ouPath = "OU=$service,$domainDN"
            
            # Groupe Global
            $ggName = "GG_$service"
            if (-not (Get-ADGroup -Filter "Name -eq '$ggName'" -ErrorAction SilentlyContinue)) {
                New-ADGroup -Name $ggName `
                            -GroupScope Global `
                            -GroupCategory Security `
                            -Path $ouPath `
                            -Description "Groupe Global pour $service" `
                            -ErrorAction Stop
                
                Write-Log "Groupe crÃ©Ã©: $ggName" -Level Success
            }
            
            # Groupe Domain Local
            $dlName = "DL_$service"
            if (-not (Get-ADGroup -Filter "Name -eq '$dlName'" -ErrorAction SilentlyContinue)) {
                New-ADGroup -Name $dlName `
                            -GroupScope DomainLocal `
                            -GroupCategory Security `
                            -Path $ouPath `
                            -Description "Groupe Domain Local pour $service" `
                            -ErrorAction Stop
                
                Write-Log "Groupe crÃ©Ã©: $dlName" -Level Success
            }
            
            # Nesting: GG dans DL (principe AGDLP)
            try {
                Add-ADGroupMember -Identity $dlName -Members $ggName -ErrorAction SilentlyContinue
            }
            catch {
                # Le membre existe dÃ©jÃ 
            }
        }
        
        Write-Log "Structure de groupes crÃ©Ã©e avec succÃ¨s." -Level Success
    }
    catch {
        Write-Log "Erreur lors de la crÃ©ation des groupes: $_" -Level Error
        throw
    }
}

function New-ADUserStructure {
    Write-Log "ğŸ‘¤ CrÃ©ation des modÃ¨les et utilisateurs..." -Level Info
    
    try {
        $securePassword = ConvertTo-SecureString $Config.Password -AsPlainText -Force
        $domainDN = (Get-ADDomain).DistinguishedName
        
        foreach ($service in $Config.Services) {
            $ouPath = "OU=$service,$domainDN"
            
            # CrÃ©ation du modÃ¨le (compte dÃ©sactivÃ©)
            $modelName = "Modele_$service"
            $modelSam = "modele$service"
            
            if (-not (Get-ADUser -Filter "SamAccountName -eq '$modelSam'" -ErrorAction SilentlyContinue)) {
                New-ADUser -Name $modelName `
                           -SamAccountName $modelSam `
                           -UserPrincipalName "$modelSam@$($Config.Domain.Name)" `
                           -AccountPassword $securePassword `
                           -Enabled $false `
                           -Path $ouPath `
                           -Description "ModÃ¨le d'utilisateur pour $service" `
                           -ChangePasswordAtLogon $false `
                           -PasswordNeverExpires $true `
                           -ErrorAction Stop
                
                Write-Log "ModÃ¨le crÃ©Ã©: $modelName" -Level Success
            }
            
            # CrÃ©ation d'un utilisateur exemple
            $userName = "User1_$service"
            $userSam = "user1$service"
            
            if (-not (Get-ADUser -Filter "SamAccountName -eq '$userSam'" -ErrorAction SilentlyContinue)) {
                New-ADUser -Name $userName `
                           -SamAccountName $userSam `
                           -UserPrincipalName "$userSam@$($Config.Domain.Name)" `
                           -AccountPassword $securePassword `
                           -Enabled $true `
                           -Path $ouPath `
                           -Description "Utilisateur exemple pour $service" `
                           -ChangePasswordAtLogon $false `
                           -PasswordNeverExpires $false `
                           -ErrorAction Stop
                
                Write-Log "Utilisateur crÃ©Ã©: $userName" -Level Success
                
                # Ajout au groupe Global
                Add-ADGroupMember -Identity "GG_$service" -Members $userSam -ErrorAction Stop
                Write-Log "Utilisateur $userName ajoutÃ© au groupe GG_$service" -Level Success
            }
        }
        
        Write-Log "Utilisateurs et modÃ¨les crÃ©Ã©s avec succÃ¨s." -Level Success
    }
    catch {
        Write-Log "Erreur lors de la crÃ©ation des utilisateurs: $_" -Level Error
        throw
    }
}
#ENDREGION

#REGION: Phase 4 - Dossiers et Partages
function New-FolderStructure {
    Write-Log "ğŸ“‚ CrÃ©ation de la structure de dossiers et partages..." -Level Info
    
    try {
        # CrÃ©ation des dossiers racines
        foreach ($rootPath in @($Config.Paths.Profils, $Config.Paths.Documents)) {
            if (-not (Test-Path $rootPath)) {
                New-Item -Path $rootPath -ItemType Directory -Force | Out-Null
                Write-Log "Dossier racine crÃ©Ã©: $rootPath" -Level Success
            }
        }
        
        # CrÃ©ation des partages SMB
        if (-not (Get-SmbShare -Name "Profils" -ErrorAction SilentlyContinue)) {
            New-SmbShare -Name "Profils" `
                         -Path $Config.Paths.Profils `
                         -FullAccess "Everyone" `
                         -ErrorAction Stop | Out-Null
            
            Write-Log "Partage SMB crÃ©Ã©: \\$($Config.Server.Name)\Profils" -Level Success
        }
        
        if (-not (Get-SmbShare -Name "Documents" -ErrorAction SilentlyContinue)) {
            New-SmbShare -Name "Documents" `
                         -Path $Config.Paths.Documents `
                         -FullAccess "Everyone" `
                         -ErrorAction Stop | Out-Null
            
            Write-Log "Partage SMB crÃ©Ã©: \\$($Config.Server.Name)\Documents" -Level Success
        }
        
        # CrÃ©ation de la structure pour chaque service
        foreach ($service in $Config.Services) {
            # Dossier de profils
            $profilPath = Join-Path $Config.Paths.Profils $service
            if (-not (Test-Path $profilPath)) {
                New-Item -Path $profilPath -ItemType Directory -Force | Out-Null
            }
            
            # Dossier de documents
            $docPath = Join-Path $Config.Paths.Documents $service
            if (-not (Test-Path $docPath)) {
                New-Item -Path $docPath -ItemType Directory -Force | Out-Null
            }
            
            # Dossier personnel utilisateur
            $userHome = Join-Path $docPath "User1_$service"
            if (-not (Test-Path $userHome)) {
                New-Item -Path $userHome -ItemType Directory -Force | Out-Null
            }
            
            # Configuration NTFS pour dossier personnel
            $userSam = "user1$service"
            $user = Get-ADUser -Identity $userSam
            $userSid = $user.SID
            
            $acl = Get-Acl $userHome
            $acl.SetAccessRuleProtection($true, $false)
            
            # Droits utilisateur: ContrÃ´le total
            $userRule = New-Object System.Security.AccessControl.FileSystemAccessRule(
                $userSid,
                "FullControl",
                "ContainerInherit,ObjectInherit",
                "None",
                "Allow"
            )
            $acl.AddAccessRule($userRule)
            
            # Droits administrateurs
            $adminRule = New-Object System.Security.AccessControl.FileSystemAccessRule(
                "BUILTIN\Administrators",
                "FullControl",
                "ContainerInherit,ObjectInherit",
                "None",
                "Allow"
            )
            $acl.AddAccessRule($adminRule)
            
            Set-Acl -Path $userHome -AclObject $acl
            
            # Dossier commun
            $communPath = Join-Path $docPath "Commun"
            if (-not (Test-Path $communPath)) {
                New-Item -Path $communPath -ItemType Directory -Force | Out-Null
            }
            
            # Configuration NTFS pour dossier commun
            $group = Get-ADGroup -Identity "DL_$service"
            $groupSid = $group.SID
            
            $aclCommun = Get-Acl $communPath
            $aclCommun.SetAccessRuleProtection($true, $false)
            
            # Droits groupe: Modification
            $groupRule = New-Object System.Security.AccessControl.FileSystemAccessRule(
                $groupSid,
                "Modify",
                "ContainerInherit,ObjectInherit",
                "None",
                "Allow"
            )
            $aclCommun.AddAccessRule($groupRule)
            $aclCommun.AddAccessRule($adminRule)
            
            Set-Acl -Path $communPath -AclObject $aclCommun
            
            Write-Log "Structure de dossiers configurÃ©e pour: $service" -Level Success
        }
        
        Write-Log "Structure complÃ¨te de dossiers et permissions crÃ©Ã©e." -Level Success
    }
    catch {
        Write-Log "Erreur lors de la crÃ©ation des dossiers: $_" -Level Error
        throw
    }
}

function Set-UserProfiles {
    Write-Log "ğŸ  Configuration des profils itinÃ©rants et rÃ©pertoires personnels..." -Level Info
    
    try {
        foreach ($service in $Config.Services) {
            $userSam = "user1$service"
            $profilePath = "\\$($Config.Server.Name)\Profils\$userSam"
            $homePath = "\\$($Config.Server.Name)\Documents\$service\User1_$service"
            
            Set-ADUser -Identity $userSam `
                       -ProfilePath $profilePath `
                       -HomeDirectory $homePath `
                       -HomeDrive "H:" `
                       -ErrorAction Stop
            
            Write-Log "Profil configurÃ© pour: $userSam" -Level Success
        }
        
        Write-Log "Profils itinÃ©rants configurÃ©s avec succÃ¨s." -Level Success
    }
    catch {
        Write-Log "Erreur lors de la configuration des profils: $_" -Level Error
        throw
    }
}
#ENDREGION

#REGION: Phase 5 - GPO
function New-GPOStructure {
    Write-Log "âš™ï¸ CrÃ©ation des stratÃ©gies de groupe (GPO)..." -Level Info
    
    try {
        Import-Module GroupPolicy -ErrorAction Stop
        
        $domainDN = (Get-ADDomain).DistinguishedName
        
        # GPO 1: Permissions locales
        $gpoName1 = "GPO_Permissions_Local"
        if (-not (Get-GPO -Name $gpoName1 -ErrorAction SilentlyContinue)) {
            $gpo1 = New-GPO -Name $gpoName1 -Comment "GPO pour gestion des permissions par groupe local"
            New-GPLink -Name $gpoName1 -Target $domainDN -LinkEnabled Yes | Out-Null
            Write-Log "GPO crÃ©Ã©e et liÃ©e: $gpoName1" -Level Success
        }
        else {
            Write-Log "GPO existe dÃ©jÃ : $gpoName1" -Level Info
        }
        
        # GPO 2: Configuration rÃ©seau
        $gpoName2 = "GPO_Configuration_Reseau"
        if (-not (Get-GPO -Name $gpoName2 -ErrorAction SilentlyContinue)) {
            $gpo2 = New-GPO -Name $gpoName2 -Comment "GPO pour configuration rÃ©seau et DHCP"
            New-GPLink -Name $gpoName2 -Target $domainDN -LinkEnabled Yes | Out-Null
            Write-Log "GPO crÃ©Ã©e et liÃ©e: $gpoName2" -Level Success
        }
        else {
            Write-Log "GPO existe dÃ©jÃ : $gpoName2" -Level Info
        }
        
        Write-Log "GPO crÃ©Ã©es avec succÃ¨s." -Level Success
    }
    catch {
        Write-Log "Erreur lors de la crÃ©ation des GPO: $_" -Level Error
        throw
    }
}
#ENDREGION

#REGION: Phase 6 - Tests et Documentation
function Invoke-Tests {
    Write-Log "ğŸ§ª ExÃ©cution des tests de validation..." -Level Info
    
    $testResults = @()
    $testFile = Join-Path $Config.Paths.Reports "Tests_Validation.txt"
    
    # Test DNS
    try {
        $dnsTest = Resolve-DnsName -Name $Config.Domain.Name -ErrorAction Stop
        $testResults += "âœ… DNS: RÃ©solution de $($Config.Domain.Name) rÃ©ussie"
        Write-Log "Test DNS: OK" -Level Success
    }
    catch {
        $testResults += "âŒ DNS: Ã‰chec de rÃ©solution"
        Write-Log "Test DNS: Ã‰CHEC" -Level Error
    }
    
    # Test DHCP
    try {
        $dhcpScope = Get-DhcpServerv4Scope -ErrorAction Stop
        $testResults += "âœ… DHCP: Ã‰tendue active dÃ©tectÃ©e - $($dhcpScope.Name)"
        Write-Log "Test DHCP: OK" -Level Success
    }
    catch {
        $testResults += "âŒ DHCP: Ã‰chec de rÃ©cupÃ©ration des Ã©tendues"
        Write-Log "Test DHCP: Ã‰CHEC" -Level Error
    }
    
    # Test AD
    try {
        $domain = Get-ADDomain -ErrorAction Stop
        $testResults += "âœ… AD: Domaine $($domain.DNSRoot) opÃ©rationnel"
        Write-Log "Test AD: OK" -Level Success
    }
    catch {
        $testResults += "âŒ AD: Domaine non accessible"
        Write-Log "Test AD: Ã‰CHEC" -Level Error
    }
    
    # Test OU
    $ouCount = (Get-ADOrganizationalUnit -Filter * | Measure-Object).Count
    $testResults += "âœ… OU: $ouCount unitÃ©s d'organisation crÃ©Ã©es"
    
    # Test Groupes
    $groupCount = (Get-ADGroup -Filter * | Measure-Object).Count
    $testResults += "âœ… Groupes: $groupCount groupes crÃ©Ã©s"
    
    # Test Utilisateurs
    $userCount = (Get-ADUser -Filter * | Measure-Object).Count
    $testResults += "âœ… Utilisateurs: $userCount comptes crÃ©Ã©s"
    
    # Test Partages
    $shares = Get-SmbShare | Where-Object { $_.Name -in @("Profils", "Documents") }
    $testResults += "âœ… Partages: $($shares.Count) partages principaux actifs"
    
    # Test GPO
    $gpoCount = (Get-GPO -All | Measure-Object).Count
    $testResults += "âœ… GPO: $gpoCount stratÃ©gies crÃ©Ã©es"
    
    # Enregistrement des rÃ©sultats
    $testResults | Out-File -FilePath $testFile -Encoding UTF8
    
    Write-Log "Tests terminÃ©s. RÃ©sultats dans: $testFile" -Level Success
    
    return $testResults
}

function Export-Documentation {
    Write-Log "ğŸ“„ GÃ©nÃ©ration de la documentation complÃ¨te..." -Level Info
    
    try {
        $docFile = Join-Path $Config.Paths.Reports "Documentation_Complete.txt"
        $domainDN = (Get-ADDomain).DistinguishedName
        
        $doc = @"
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    DOCUMENTATION SERVEUR GSB - VERSION 3.5
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Date de gÃ©nÃ©ration : $(Get-Date -Format "dd/MM/yyyy HH:mm:ss")
GÃ©nÃ©rÃ© par         : $env:USERNAME
Serveur            : $($Config.Server.Name)
Domaine            : $($Config.Domain.Name)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. CONFIGURATION RÃ‰SEAU
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Adresse IP         : $($Config.Server.IP)
Masque (PrÃ©fixe)   : /$($Config.Server.PrefixLength) ($($Config.DHCP.SubnetMask))
Passerelle         : $($Config.Server.Gateway)
Serveur DNS        : $($Config.Server.IP) (lui-mÃªme)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2. CONFIGURATION DHCP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Nom de l'Ã©tendue   : $($Config.DHCP.ScopeName)
Plage IP           : $($Config.DHCP.ScopeStart) - $($Config.DHCP.ScopeEnd)
Masque sous-rÃ©seau : $($Config.DHCP.SubnetMask)
ID Ã©tendue         : $($Config.DHCP.ScopeID)
Exclusions         : $($Config.DHCP.ExclusionStart) - $($Config.DHCP.ExclusionEnd)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3. STRUCTURE ACTIVE DIRECTORY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

UNITÃ‰S D'ORGANISATION (OU):
$(Get-ADOrganizationalUnit -Filter * | Sort-Object Name | Format-Table Name, DistinguishedName -AutoSize | Out-String)

GROUPES DE SÃ‰CURITÃ‰:
$(Get-ADGroup -Filter * | Sort-Object Name | Format-Table Name, GroupScope, GroupCategory, Description -AutoSize | Out-String)

COMPTES UTILISATEURS:
$(Get-ADUser -Filter * -Properties Description | Sort-Object Name | Format-Table Name, SamAccountName, Enabled, Description -AutoSize | Out-String)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4. PARTAGES SMB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$(Get-SmbShare | Format-Table Name, Path, Description -AutoSize | Out-String)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5. STRATÃ‰GIES DE GROUPE (GPO)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$(Get-GPO -All | Sort-Object DisplayName | Format-Table DisplayName, GpoStatus, CreationTime -AutoSize | Out-String)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6. INFORMATIONS DE SÃ‰CURITÃ‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸  MOTS DE PASSE CONFIGURÃ‰S:
    - Tous les utilisateurs : $($Config.Password)
    - Mode restauration AD  : $($Config.Domain.SafeModePassword)

âš ï¸  ACTIONS RECOMMANDÃ‰ES:
    1. Changer immÃ©diatement les mots de passe en production
    2. ImplÃ©menter une politique de mots de passe forte
    3. Activer l'audit des Ã©vÃ©nements de sÃ©curitÃ©
    4. Configurer Windows Defender et le pare-feu
    5. Mettre en place des sauvegardes rÃ©guliÃ¨res
    6. Documenter les procÃ©dures de rÃ©cupÃ©ration

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
7. PROCHAINES Ã‰TAPES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â˜ Configurer les GPO avancÃ©es (redirection de dossiers, scripts, etc.)
â˜ Joindre les postes clients au domaine
â˜ Tester la connexion avec diffÃ©rents utilisateurs
â˜ Configurer la sauvegarde du contrÃ´leur de domaine
â˜ Configurer le pare-feu Windows avec rÃ¨gles avancÃ©es
â˜ Mettre en place le monitoring et les alertes
â˜ Former les utilisateurs et administrateurs
â˜ Documenter les procÃ©dures opÃ©rationnelles

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              FIN DE LA DOCUMENTATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"@
        
        $doc | Out-File -FilePath $docFile -Encoding UTF8
        Write-Log "Documentation gÃ©nÃ©rÃ©e: $docFile" -Level Success
    }
    catch {
        Write-Log "Erreur lors de la gÃ©nÃ©ration de la documentation: $_" -Level Error
    }
}
#ENDREGION

#REGION: Programme Principal
try {
    Write-Host "`n"
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
    Write-Host "                  CONFIGURATION AUTOMATISÃ‰E SERVEUR GSB v3.5                    " -ForegroundColor Cyan
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
    Write-Host "`n"
    
    Write-Log "ğŸš€ DÃ©but de la configuration du serveur GSB" -Level Info
    Write-Log "Version du script: 3.5 Final" -Level Info
    Write-Log "Date: $(Get-Date -Format 'dd/MM/yyyy HH:mm:ss')" -Level Info
    Write-Log "Utilisateur: $env:USERNAME" -Level Info
    
    # Phase 0: PrÃ©paration
    Initialize-Environment
    Install-RequiredModules
    
    # VÃ©rification des redÃ©marrages en attente
    if (Test-PendingReboot) {
        Write-Log "âš ï¸  Un redÃ©marrage est en attente. Veuillez redÃ©marrer le serveur et relancer ce script." -Level Warning
        Read-Host "`nAppuyez sur EntrÃ©e pour redÃ©marrer maintenant"
        Restart-Computer -Force
        exit
    }
    
    # Phase 1: Configuration de base (Nom + IP)
    Write-Log "`nâ•â•â• PHASE 1: Configuration de base du serveur â•â•â•" -Level Info
    
    $needsReboot = Set-ServerName
    
    if ($needsReboot) {
        Write-Host "`n" -ForegroundColor Yellow
        Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Yellow
        Write-Host "â•‘           REDÃ‰MARRAGE REQUIS (Renommage)                  â•‘" -ForegroundColor Yellow
        Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Yellow
        Write-Host "`nLe serveur doit redÃ©marrer pour appliquer le nouveau nom." -ForegroundColor White
        Write-Host "AprÃ¨s le redÃ©marrage, relancez ce script pour continuer.`n" -ForegroundColor White
        Read-Host "Appuyez sur EntrÃ©e pour redÃ©marrer"
        Restart-Computer -Force
        exit
    }
    
    # Configuration IP
    $interfaceName = Set-StaticIP
    
    # Phase 2: Installation des rÃ´les serveur
    Write-Log "`nâ•â•â• PHASE 2: Installation des rÃ´les serveur â•â•â•" -Level Info
    
    $needsReboot = Install-ServerRoles
    
    if ($needsReboot) {
        Write-Host "`n" -ForegroundColor Yellow
        Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Yellow
        Write-Host "â•‘       REDÃ‰MARRAGE REQUIS (Installation rÃ´les)             â•‘" -ForegroundColor Yellow
        Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Yellow
        Write-Host "`nLes rÃ´les serveur ont Ã©tÃ© installÃ©s. Un redÃ©marrage est nÃ©cessaire." -ForegroundColor White
        Write-Host "AprÃ¨s le redÃ©marrage, relancez ce script pour continuer.`n" -ForegroundColor White
        Read-Host "Appuyez sur EntrÃ©e pour redÃ©marrer"
        Restart-Computer -Force
        exit
    }
    
    # Phase 3: VÃ©rification et promotion Active Directory
    Write-Log "`nâ•â•â• PHASE 3: Configuration Active Directory â•â•â•" -Level Info
    
    $needsPromotion = Test-AndPromoteDomainController
    
    if ($needsPromotion) {
        Install-ADDSForest
        # Le serveur redÃ©marre automatiquement aprÃ¨s la promotion
        exit
    }
    
    # Si nous arrivons ici, AD est dÃ©jÃ  installÃ© et configurÃ©
    Write-Log "Active Directory est opÃ©rationnel. Passage Ã  la configuration post-installation." -Level Success
    
    # Attente de stabilisation des services AD
    Write-Log "Attente de la stabilisation des services Active Directory (30 secondes)..." -Level Info
    Start-Sleep -Seconds 30
    
    # Import des modules AD
    Import-Module ActiveDirectory -ErrorAction Stop
    Import-Module GroupPolicy -ErrorAction Stop
    
    # Phase 4: Configuration post-AD
    Write-Log "`nâ•â•â• PHASE 4: Configuration DHCP â•â•â•" -Level Info
    Configure-DHCP
    
    Write-Log "`nâ•â•â• PHASE 5: CrÃ©ation de la structure Active Directory â•â•â•" -Level Info
    New-OUStructure
    New-ADGroupStructure
    New-ADUserStructure
    
    Write-Log "`nâ•â•â• PHASE 6: Configuration des dossiers et partages â•â•â•" -Level Info
    New-FolderStructure
    Set-UserProfiles
    
    Write-Log "`nâ•â•â• PHASE 7: Configuration des GPO â•â•â•" -Level Info
    New-GPOStructure
    
    Write-Log "`nâ•â•â• PHASE 8: Tests de validation â•â•â•" -Level Info
    $testResults = Invoke-Tests
    
    Write-Log "`nâ•â•â• PHASE 9: GÃ©nÃ©ration de la documentation â•â•â•" -Level Info
    Export-Documentation
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # RÃ‰SUMÃ‰ FINAL
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Write-Host "`n"
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
    Write-Host "                 âœ… CONFIGURATION TERMINÃ‰E AVEC SUCCÃˆS âœ…                         " -ForegroundColor Green
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
    Write-Host "`n"
    
    Write-Host "ğŸ“‹ INFORMATIONS PRINCIPALES:" -ForegroundColor Cyan
    Write-Host "   â€¢ Domaine          : " -NoNewline; Write-Host "$($Config.Domain.Name)" -ForegroundColor Yellow
    Write-Host "   â€¢ Serveur          : " -NoNewline; Write-Host "$($Config.Server.Name)" -ForegroundColor Yellow
    Write-Host "   â€¢ Adresse IP       : " -NoNewline; Write-Host "$($Config.Server.IP)" -ForegroundColor Yellow
    Write-Host "   â€¢ Services (OU)    : " -NoNewline; Write-Host "$($Config.Services.Count) unitÃ©s d'organisation" -ForegroundColor Yellow
    Write-Host "   â€¢ Utilisateurs     : " -NoNewline; Write-Host "$(($Config.Services.Count * 2)) comptes (modÃ¨les + users)" -ForegroundColor Yellow
    Write-Host "   â€¢ Groupes          : " -NoNewline; Write-Host "$(($Config.Services.Count * 2)) groupes (GG + DL)" -ForegroundColor Yellow
    Write-Host "`n"
    
    Write-Host "ğŸ“ PARTAGES RÃ‰SEAU:" -ForegroundColor Cyan
    Write-Host "   â€¢ Profils          : " -NoNewline; Write-Host "\\$($Config.Server.Name)\Profils" -ForegroundColor Yellow
    Write-Host "   â€¢ Documents        : " -NoNewline; Write-Host "\\$($Config.Server.Name)\Documents" -ForegroundColor Yellow
    Write-Host "`n"
    
    Write-Host "ğŸ“Š RAPPORTS GÃ‰NÃ‰RÃ‰S:" -ForegroundColor Cyan
    Write-Host "   â€¢ Emplacement      : " -NoNewline; Write-Host "$($Config.Paths.Reports)" -ForegroundColor Yellow
    Write-Host "   â€¢ Log installation : Installation.log" -ForegroundColor White
    Write-Host "   â€¢ Tests validation : Tests_Validation.txt" -ForegroundColor White
    Write-Host "   â€¢ Documentation    : Documentation_Complete.txt" -ForegroundColor White
    Write-Host "`n"
    
    Write-Host "ğŸ” INFORMATIONS DE CONNEXION:" -ForegroundColor Cyan
    Write-Host "   â€¢ Domaine          : $($Config.Domain.Name)" -ForegroundColor White
    Write-Host "   â€¢ Utilisateurs test: user1[service]@$($Config.Domain.Name)" -ForegroundColor White
    Write-Host "     Exemples         : user1ReseauSysteme@$($Config.Domain.Name)" -ForegroundColor Gray
    Write-Host "                        user1Commercial@$($Config.Domain.Name)" -ForegroundColor Gray
    Write-Host "   â€¢ Mot de passe     : " -NoNewline; Write-Host "$($Config.Password)" -ForegroundColor Yellow
    Write-Host "`n"
    
    Write-Host "ğŸ“ RÃ‰SULTATS DES TESTS:" -ForegroundColor Cyan
    foreach ($result in $testResults) {
        if ($result -match "âœ…") {
            Write-Host "   $result" -ForegroundColor Green
        }
        elseif ($result -match "âŒ") {
            Write-Host "   $result" -ForegroundColor Red
        }
    }
    Write-Host "`n"
    
    Write-Host "ğŸ¯ PROCHAINES Ã‰TAPES:" -ForegroundColor Cyan
    Write-Host "   1ï¸âƒ£  Configurer les GPO avancÃ©es (via GPMC)" -ForegroundColor White
    Write-Host "   2ï¸âƒ£  Joindre les postes clients au domaine" -ForegroundColor White
    Write-Host "   3ï¸âƒ£  Tester la connexion avec un utilisateur" -ForegroundColor White
    Write-Host "   4ï¸âƒ£  Configurer le pare-feu Windows" -ForegroundColor White
    Write-Host "   5ï¸âƒ£  Mettre en place les sauvegardes" -ForegroundColor White
    Write-Host "   6ï¸âƒ£  Former les utilisateurs" -ForegroundColor White
    Write-Host "`n"
    
    Write-Host "âš ï¸  AVERTISSEMENTS DE SÃ‰CURITÃ‰:" -ForegroundColor Red
    Write-Host "   â€¢ Changez immÃ©diatement tous les mots de passe en production!" -ForegroundColor Yellow
    Write-Host "   â€¢ Activez une politique de mots de passe forte" -ForegroundColor Yellow
    Write-Host "   â€¢ Configurez l'audit de sÃ©curitÃ©" -ForegroundColor Yellow
    Write-Host "   â€¢ Mettez en place une stratÃ©gie de sauvegarde" -ForegroundColor Yellow
    Write-Host "`n"
    
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
    Write-Host "                          Configuration terminÃ©e !                              " -ForegroundColor Green
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
    Write-Host "`n"
    
    Write-Log "âœ… Configuration du serveur GSB terminÃ©e avec succÃ¨s!" -Level Success
}
catch {
    Write-Host "`n"
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Red
    Write-Host "                         âŒ ERREUR CRITIQUE âŒ                                   " -ForegroundColor Red
    Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Red
    Write-Host "`n"
    
    Write-Log "ERREUR CRITIQUE: $($_.Exception.Message)" -Level Error
    Write-Log "Trace complÃ¨te: $($_.ScriptStackTrace)" -Level Error
    
    Write-Host "Erreur: " -NoNewline -ForegroundColor Red
    Write-Host "$($_.Exception.Message)" -ForegroundColor White
    Write-Host "`n"
    Write-Host "Pour plus de dÃ©tails, consultez le fichier log:" -ForegroundColor Yellow
    Write-Host "$(Join-Path $Config.Paths.Reports 'Installation.log')" -ForegroundColor Cyan
    Write-Host "`n"
    
    exit 1
}
finally {
    $ProgressPreference = "Continue"
}
#ENDREGION

<#
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              NOTES D'UTILISATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… AMÃ‰LIORATIONS VERSION 3.5:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. MOT DE PASSE UNIFIÃ‰
   - Tous les comptes utilisent: Ndlp#2022
   - Mode restauration AD (DSRM): Ndlp#2022
   - Plus besoin de saisir les mots de passe

2. INSTALLATION AUTOMATIQUE DES SERVICES
   - DÃ©tection automatique des fonctionnalitÃ©s manquantes
   - Installation automatique d'AD DS, DNS, DHCP
   - Installation des outils de gestion (RSAT)

3. PROMOTION AUTOMATIQUE EN CONTRÃ”LEUR DE DOMAINE
   - DÃ©tection si le serveur est dÃ©jÃ  un DC
   - Promotion automatique si nÃ©cessaire
   - Gestion intelligente des redÃ©marrages

4. GESTION ROBUSTE DES ERREURS
   - Try-Catch sur toutes les opÃ©rations critiques
   - Messages d'erreur dÃ©taillÃ©s avec icÃ´nes
   - Logs structurÃ©s et horodatÃ©s

5. IDEMPOTENCE TOTALE
   - Le script peut Ãªtre relancÃ© sans problÃ¨me
   - VÃ©rification de l'existence avant chaque crÃ©ation
   - Pas d'erreurs si les objets existent dÃ©jÃ 

6. INTERFACE AMÃ‰LIORÃ‰E
   - Messages avec icÃ´nes (âœ… âŒ âš ï¸ â„¹ï¸)
   - Codes couleur clairs
   - RÃ©sumÃ© final dÃ©taillÃ©

ğŸ“‹ PRÃ‰REQUIS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Windows Server 2019/2022
â€¢ PowerShell 5.1 ou supÃ©rieur
â€¢ Droits administrateur
â€¢ Disque D: disponible (crÃ©Ã© automatiquement si possible)
â€¢ Connexion rÃ©seau fonctionnelle

ğŸš€ EXÃ‰CUTION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Ouvrir PowerShell en tant qu'Administrateur
2. Naviguer vers le dossier du script
3. ExÃ©cuter: .\Configure-GSBServer-Final.ps1
4. Suivre les instructions Ã  l'Ã©cran
5. Relancer aprÃ¨s chaque redÃ©marrage si nÃ©cessaire

ğŸ”„ REDÃ‰MARRAGES AUTOMATIQUES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Le script peut nÃ©cessiter jusqu'Ã  3 redÃ©marrages:
1. AprÃ¨s le renommage du serveur
2. AprÃ¨s l'installation des rÃ´les (si nÃ©cessaire)
3. AprÃ¨s la promotion en contrÃ´leur de domaine

â¡ï¸  Relancez simplement le script aprÃ¨s chaque redÃ©marrage, il reprendra
    automatiquement lÃ  oÃ¹ il s'Ã©tait arrÃªtÃ©.

ğŸ” SÃ‰CURITÃ‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸  IMPORTANT: Ce script utilise un mot de passe en clair pour la dÃ©monstration.

EN PRODUCTION:
â€¢ Changez IMMÃ‰DIATEMENT tous les mots de passe
â€¢ Utilisez des mots de passe complexes et uniques
â€¢ ImplÃ©mentez une politique de mots de passe forte
â€¢ Utilisez LAPS pour les comptes administrateurs locaux
â€¢ Activez l'audit de sÃ©curitÃ©
â€¢ Configurez le pare-feu Windows
â€¢ Mettez en place des sauvegardes rÃ©guliÃ¨res

ğŸ“ FICHIERS GÃ‰NÃ‰RÃ‰S:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Installation.log           : Journal dÃ©taillÃ© de toutes les opÃ©rations
â€¢ Tests_Validation.txt        : RÃ©sultats des tests de validation
â€¢ Documentation_Complete.txt  : Documentation complÃ¨te de la configuration

ğŸ§ª TESTS DE VALIDATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Le script effectue automatiquement les tests suivants:
âœ“ RÃ©solution DNS du domaine
âœ“ Fonctionnement du serveur DHCP
âœ“ AccessibilitÃ© d'Active Directory
âœ“ VÃ©rification des OU crÃ©Ã©es
âœ“ VÃ©rification des groupes crÃ©Ã©s
âœ“ VÃ©rification des utilisateurs crÃ©Ã©s
âœ“ VÃ©rification des partages SMB
âœ“ VÃ©rification des GPO crÃ©Ã©es

ğŸ“ SUPPORT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
